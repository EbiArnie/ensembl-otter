#!/bin/sh


http_proxy=http://webcache.sanger.ac.uk:3128
export http_proxy
no_proxy=.sanger.ac.uk,localhost
export no_proxy

export HTTP_PROXY="$http_proxy" NO_PROXY="$no_proxy" HTTPS_PROXY="$http_proxy" https_proxy="$http_proxy"

anasoft="/software/anacode"
: ${OTTER_DEV:="$anasoft/otter/otter_dev"}

if ! grep -q otterlace_installed=true $OTTER_DEV/bin/otterlace; then
    echo $OTTER_DEV is broken.
    OTTER_DEV="$anasoft/otter/otter_live"
    echo Switching to $OTTER_DEV
fi

OTTER_HOME="$( cd -P $( dirname "$0" )/..; pwd )"
export OTTER_HOME

printf '\nOTTER_HOME=%s OTTER_DEV=%s\n' "$OTTER_HOME" "$OTTER_DEV"

otterlib="$OTTER_DEV/lib"

unset LD_LIBRARY_PATH

anasoft_distro="$anasoft/distro/$( $anasoft/bin/anacode_distro_code )"

otterbin="$OTTER_HOME/scripts/client:\
$OTTER_DEV/bin:\
$anasoft_distro/bin:\
$anasoft/bin:\
/software/pubseq/bin/EMBOSS-5.0.0/bin:\
/software/perl-5.12.2/bin\
"

if [ -n "$ZMAP_BIN" ]
then
    otterbin="$ZMAP_BIN:$otterbin"
    echo "  Hacked otterbin for ZMAP_BIN=$ZMAP_BIN" >&2
fi

if [ -n "$PATH" ]
then
    PATH="$otterbin:$PATH"
else
    PATH="$otterbin"
fi
export PATH

# Settings for wublast needed by local blast searches
WUBLASTFILTER=$anasoft/bin/wublast/filter
export WUBLASTFILTER
WUBLASTMAT=$anasoft/bin/wublast/matrix
export WUBLASTMAT

# Some setup for acedb
ACEDB_NO_BANNER=1
export ACEDB_NO_BANNER

#cp -f "$OTTER_HOME/acedbrc" ~/.acedbrc

PERL5LIB="\
$HOME/cvswork-anacode/PerlModules:\
$OTTER_HOME/modules:\
$HOME/cvswork-ensembl/ensembl-analysis/modules:\
$HOME/cvswork-ensembl/ensembl-pipeline/modules:\
$HOME/_httpd2/apps/webvm-deps/ensembl-branch-74/ensembl/modules:\
$HOME/_httpd2/apps/webvm-deps/ensembl-branch-74/ensembl-variation/modules:\
$OTTER_DEV/lib/perl5:\
$anasoft_distro/lib/site_perl:\
$anasoft/lib/site_perl\
"

if [ -n "$ZMAP_LIB" ]
then
    PERL5LIB="$ZMAP_LIB:$ZMAP_LIB/site_perl:$PERL5LIB"
    echo "  Hacked PERL5LIB for ZMAP_LIB=$ZMAP_LIB" >&2
fi

export PERL5LIB

if [ "$1" = '-S' ]; then
    export debian_chroot='otterlace_dev'
    exec bash -i
else
    exec perl "$OTTER_HOME/tk/otterlace" $@
fi
