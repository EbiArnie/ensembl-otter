#!/usr/bin/env perl

### generate_solexa_config

use strict;
use warnings;

{
    my %solex = qw{
        ERS000081 1dpf
        ERS000082 2dpf
        ERS000083 3dpf
        ERS000084 5dpf
        ERS000085 14dpf
        ERS000086 female_body
        ERS000087 male_body
        ERS000088 female_head
        ERS000089 male_head
        ERS000090 ovary
    };

    my @templates = (

q{
[zebrafish.filter.sg_%s-%s]
server_script=get_gff_genes
metakey=ensembl_solexagene_mar2010_db_head
csver_remote=Zv9
analysis=refine_%s
description=RNAseq Solexa genes from ensembl (%s / March 2010)
process_gff_file=1
zmap_column=solexa_genes
zmap_style=solexa_genes
},

q{
[zebrafish.filter.si_%s-%s]
server_script=get_gff_features
filter_module=Bio::Vega::ServerAnalysis::SolexaIntronFilter
analysis=1dpf
metakey=solexa_raw_introns
description=Filtered set of intron-confirming RNAseq reads (%s)
feature_kind=DnaDnaAlignFeature
zmap_column=solexa_introns
zmap_style=solexa_introns
},

q{
[zebrafish.filter.sc_%s-%s]
server_script=get_gff_features
filter_module=Bio::Vega::ServerAnalysis::SolexaDepthBins
analysis=37bp_%s_ga,76bp_%s_ga
metakey=solexa_raw_reads
csver_remote=Zv9
description=Coverage plot of RNAseq reads (%s)
feature_kind=DnaDnaAlignFeature
zmap_column=solexa_coverage
zmap_style=solexa_coverage
},

);    

    my $head = "\n[zebrafish.use_filters]\n";
    my $body = "";
    foreach my $config (@templates) {
        my $fields = $config =~ tr/%/%/;
        foreach my $acc (sort keys %solex) {
            my $stage = $solex{$acc};
            my @args = ($stage, $acc);
            until (@args == $fields) {
                push(@args, $stage);
            }
            my $this .= sprintf $config, @args;
            my ($filter) = $this =~ /\[zebrafish.filter.([^\}]+)\]/;
            $head .= "$filter=1\n";
            $body .= $this;
        }
    }
    print $head, $body;
}



__END__

=head1 NAME - generate_solexa_config

=head1 AUTHOR

James Gilbert B<email> jgrg@sanger.ac.uk

