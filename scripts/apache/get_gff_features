#!/usr/local/bin/perl -Tw

# Author:        gr5
# Group:         anacode
# Maintainer:    gr5

use strict;
use warnings;

use SangerPaths qw{ core bioperl123 ensembl60 otter54 };

use Bio::Otter::ServerScriptSupport;
use Bio::Vega::Utils::EnsEMBL2GFF;

my $server = Bio::Otter::ServerScriptSupport->new;

my $gff_string = '';

eval {
    my $features = $server->get_requested_features;

    my %gff_args;
    $gff_args{$_} = $server->param($_) for qw(
        rebase
        gff_source
        gff_seqname
    );

    for my $f (@$features) {
        my $gff = $f->to_gff(%gff_args);
        $gff_string .= $gff if $gff;
    }
};

if ($@) {
    $server->error_exit($@);
}
else {
    $server->send_response($server->gff_header . $gff_string, 0, 1);
}

1;

