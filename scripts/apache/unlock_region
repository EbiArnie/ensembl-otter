#!/usr/bin/perl -Tw

# Author:        jgrg
# Group:         anacode
# Maintainer:    jgrg

use strict;
use warnings;

BEGIN { use lib ($ENV{OTTER_PERL_INC} || q{}) =~ m{([^:]+)}g }
use SangerPaths qw{ core bioperl123 ensembl71 otter76 };

use Bio::Otter::ServerScriptSupport;
use Bio::Otter::ServerAction::Region;
use Bio::Vega::Transform::Otter;

sub unlock_region {
    my ($server) = @_;

    my $sa_region = Bio::Otter::ServerAction::Region->new($server);

    $sa_region->unlock_region(\&deserialise_lock_token);

    return $server->otter_wrap_response("<response>\n</response>\n");
}

sub deserialise_lock_token {
    my ($token) = @_;

    my $parser = Bio::Vega::Transform::Otter->new;
    $parser->parse($token);

    return $parser->get_ChromosomeSlice;
}

Bio::Otter::ServerScriptSupport->send_response(\&unlock_region);
