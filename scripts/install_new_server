#!/usr/local/bin/perl -w

if(scalar(@ARGV)<2) {
	print STDERR "usage:\n";
	print STDERR "\t$0 your_CVS_username new_directory [humpub-release-NN]\n";
	exit 0;
}
my ($user, $new_dir, $new_tag) = @ARGV;

# ----------------------------------------------------------------------

my $method = 'checkout'; # || 'export'
my $tagfile = 'CVS_TAG';

my $biolocation = '/nfs/team71/analysis/lg4/work/distrib';

my @cvs_locations = (
	[":ext:${user}\@cvs.sanger.ac.uk:/nfs/ensembl/cvsroot", $method, '-r', 'branch-ensembl-19', 'ensembl'],
	[":ext:${user}\@cvs.sanger.ac.uk:/nfs/ensembl/cvsroot", $method, (defined($new_tag)?('-r', $new_tag):()), 'ensembl-otter' ],
	[":ext:${user}\@cvs.sanger.ac.uk:/nfs/ensembl/cvsroot", $method, '-d', 'ensembl_head', 'ensembl'],
);

# ----------------------------------------------------------------------

mkdir($new_dir);
chdir($new_dir);
$new_tag ||= 'HEAD';
system("echo $new_tag > $tagfile");

foreach my $cvs_location (@cvs_locations) {
	if($cvs_location->[0]=~/\@/) {
		print "\nPlease enter your CVS password below\n";
	}
	system('cvs', '-d', @$cvs_location);
}

for my $biodir ('bioperl-0.7.2') {
    system('cp', $biolocation.'/'.$biodir.'.tar.gz', '.');
    system('gunzip', $biodir.'.tar.gz');
    system('tar', '-xvf', $biodir.'.tar');
    system('rm', $biodir.'.tar');
}

system('touch', '.ensemblapi_no_version_check');

system('chmod -R g+w *');

