#!/usr/local/bin/perl -w

my $pipehead = $ENV{PIPEHEAD}; # is set by the server for any GET request

use strict;
use OtterDefs;
use Bio::Otter::ServerQuery;
use Bio::Otter::ServerSide (':all');
use Bio::Otter::CloneFinder; # pipehead=0 version only

$| = 1;

my $sq = Bio::Otter::ServerQuery->new('dataset','qnames','type','maxpipehits','unhide');
set_nph($sq);

my $qnames = $sq->getarg('qnames') || error_exit($sq, "No 'qnames' argument entered");
my $filter_atype = $sq->getarg('type') || '';
my $unhide = $sq->getarg('unhide') || 0;

my $odba = get_DBAdaptor_from_CGI_species($sq, $OTTER_SPECIES, $pipehead);

my $finder = Bio::Otter::CloneFinder($odba, [ split(',', $qnames) ]);

$finder->find_otter_clones_by_qnames();

$finder->find_assemblies_by_clone_names($unhide);

my $output_string = generate_output($filter_atype);

send_response($sq, $output_string, 1);

1;

