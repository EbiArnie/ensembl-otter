#!/usr/local/bin/perl -w

my $pipehead = $ENV{PIPEHEAD}; # is set by the server for any GET request

use strict;
use OtterDefs;
use CGI;
use Bio::Otter::ServerSide (':all');
use Bio::Otter::Lace::PipelineDB;
use Bio::EnsEMBL::DBSQL::DBAdaptor;
use Bio::Otter::DBSQL::DBAdaptor;
use Bio::Otter::ToXML;

$| = 1;

my $cgi = new CGI;
set_nph($cgi);
my %cgi_args = $cgi->Vars;

my $odb = get_DBAdaptor_from_CGI_species($cgi, $OTTER_SPECIES, $pipehead);
my ($pdb, $pipeline_slice, $pipe_connparms) = get_pipeline_adaptor_slice_parms($cgi, $odb, $pipehead);

my $analysis = $cgi_args{analysis};
my $genes = $pipeline_slice->get_all_Genes($analysis);

server_log("Total of ".scalar(@$genes)." $analysis genes found");

my $output_string = '';

foreach my $gene (@$genes) {
    $output_string .= $gene->toXMLstring();
}

send_response($cgi, $output_string, 1);

